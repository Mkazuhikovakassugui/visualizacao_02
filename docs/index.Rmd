---
title: "Relatório de desempenho dos alunos no Exame Nacional de Ensino Médio (ENEM) por município"
author: "Elaborado por: Marcio Vakassugui"
date: '01-07-2022'
output: 
  html_document:
    highlight: breezedark
    code_folding: hide
    self_contained: true
    theme: cosmo
    toc: yes
    toc_float: yes
    smooth_scroll: no
    collapsed: yes
params:
    cidade: "Curitiba"
    estado: "PR"
    ano: 2020
css: custom.css
---

```{r label= 'setup_geral'}
#| include = FALSE

knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  fig.width = 14,
  fig.height = 7
)
```

```{r label = 'leitura_base_de_dados'}
#| echo = FALSE

enem <- readr:: read_csv("../data/enem_analise_final.csv")

```

```{r label =  'base_para_cidade_e_ano'}
#| echo = FALSE

enem_cidade <- enem |> 
  dplyr::filter(no_municipio_prova == params$cidade & nu_ano == params$ano)

```

<br>

# Objetivo

Elaborar um modelo de relatório em HTML, produzido em RMarkdown, que apresente visualizações de desempenho dos alunos na prova do Exame Nacional do Ensino Médio (ENEM) por município.  

O modelo deve ter a característica de reprodutibilidade, de modo que cada relatório (formato, textos e visualizações) seja produzido a partir de uma rotina de procedimentos (*script*) de forma automatizada para todos os 88 municípios do estado do Paraná, nos quais as provas foram realizadas.

```{r label = 'total_de_alunos'}
#| echo = FALSE

total_alunos_municipio <- enem_cidade |> # total de alunos classificados no município
  dplyr::summarise(total_alunos = dplyr::n())

```

<br>

# Informações Gerais

### Dados do exame

| Município: `r params$cidade`                | Estado: `r params$estado` |
|:--------------------------------------------|--------------------------:|
|                                             |                           |
```{r label = 'base_mapa_cidade'}
#| echo = FALSE,
#| include = FALSE

# Carregar bibliotecas para a construção do mapa e função do tema dos gráficos
library(geobr)
library(sf)
source("../R/funcao_tema_graficos.R")
dados_geobr <- geobr::read_municipality("PR")

```


```{r label = 'mapa_municipio'}
#| fig.out = "100%"

dados_geobr |>
  dplyr::filter(name_muni == params$cidade) |>
  ggplot2::ggplot() +
  ggplot2::geom_sf(
    data = dados_geobr,
    fill = "#70A288",
    color = "#000000",
    size = .1,
    alpha = 0.7
  ) +
  ggplot2::geom_sf(ggplot2::aes(fill = name_muni)) +
  ggspatial::annotation_north_arrow(location = "tr") +
  ggplot2::theme_classic() +
  theme_enem() +
  ggplot2::theme(
    legend.title = ggplot2::element_blank(),
    legend.background = ggplot2::element_rect(
      fill = "#EBF9FF",
      colour = "#EBF9FF"
    )
  )

```

<br>

|                                                  |                              |                     
|:-------------------------------------------------|-----------------------------:|
| Alunos classificados: `r total_alunos_municipio` |  Ano do exame: `r params$ano`|

<br>

```{r label = 'lista_estados_da_federacao'}
#| echo = FALSE

# A partir da sigla da UF definir o nome do estado da federação
estado_federacao <- dplyr::case_when(
    params$estado == "AC" ~ "Acre",
    params$estado == "AL" ~ "Alagoas",
    params$estado == "AP" ~ "Amapá",
    params$estado == "AM" ~ "Amazonas", 
    params$estado == "BA" ~ "Bahia", 
    params$estado == "CE" ~ "Ceará", 
    params$estado == "DF" ~ "Distrito Federal", 
    params$estado == "ES" ~ "Espírito Santo", 
    params$estado == "GO" ~ "Goiás",
    params$estado == "MA" ~ "Maranhão", 
    params$estado == "MT" ~ "Mato Grosso",
    params$estado == "MS" ~ "Mato Grosso do Sul",
    params$estado == "MG" ~ "Minas Gerais", 
    params$estado == "PA" ~ "Pará", 
    params$estado == "PB" ~ "Paraíba", 
    params$estado == "PR" ~ "Paraná",
    params$estado == "PE" ~ "Pernambuco", 
    params$estado == "PI" ~ "Piauí", 
    params$estado == "RJ" ~ "Rio de Janeiro", 
    params$estado == "RN" ~ "Rio Grande do Norte",
    params$estado == "RS" ~ "Rio Grande do Sul", 
    params$estado == "RO" ~ "Rondônia", 
    params$estado == "RR" ~ "Roraima", 
    params$estado == "SC" ~ "Santa Catarina",
    params$estado == "SP" ~ "São Paulo",
    params$estado == "SE" ~ "Sergipe",
    params$estado == "TO" ~ "Tocantins"
)
```

# Prova de redação

```{r label = 'notas_máximas_redacao_quantidade_de_zeros_média_município'}
#| echo = FALSE

nota_max <- enem_cidade |>
    dplyr::summarize(nota_max = max(nu_nota_redacao))

nota_min <- enem_cidade |>
    dplyr::summarise(nota_min = min(nu_nota_redacao))

nota_media <- enem_cidade |>
    dplyr::summarise(nota_media = mean(nu_nota_redacao, na.rm = TRUE))

zeros_redacao <- enem |>
    dplyr::filter(no_municipio_prova == params$cidade & nu_nota_redacao == 0 & nu_ano == params$ano) |>
    dplyr:: summarise(qtde_zeros = dplyr::n())

perc_zeros_redacao <- enem_cidade |>
    dplyr::summarise(perc_zeros_redacao = round((zeros_redacao / total_alunos_municipio)*100,3))

```

```{r label = 'base_grafico_freq_relativa_intervalo_de_classes'}
#| echo = FALSE

fabs_notas_redacao <- enem_cidade |>
  dplyr::select(nu_nota_redacao) |>
  table()

# total de alunos com nota máxima

qtd_nota_max <- fabs_notas_redacao |>
  tail(n=1) 

# criar as classes de frequências das notas

intervalo_classes_notas <- seq(0, 1000, 100)
tab_classes_notas <- table(cut(enem_cidade$nu_nota_redacao,
                               breaks = intervalo_classes_notas,
                               right = FALSE)) |>
  prop.table() |>
  data.frame() |>
  dplyr::mutate(Freq = Freq*100)

```

### Distribuição das notas de redação
As notas das redações variam de 0 a 1000 pontos. No gráfico 01, pode-se visualizar por meio do boxPlot e do histograma a média e a distribuição das notas. <br>


```{r label= gráfico_01}
#| fig.cap = "Gráfico 01 - BoxPlot e histograma da distribuição de notas de redação",

# carregar a biblioteca patchwork
library(patchwork)   # para união dos gráficos

# gráfico do boxplot das notas das redações (parte superior da visualização)
p1_1 <- enem_cidade |>
  dplyr::select(nu_nota_redacao) |>
  ggplot2::ggplot(ggplot2::aes(x = nu_nota_redacao)) +
  ggplot2::geom_boxplot(
    fill = "#11B5E4",
    alpha = 0.7
  ) +
  ggplot2::labs(
    title = "Distribuição das notas de redação ",
    x = "",
    y = ""
  ) +
  ggplot2::theme_classic() +
  theme_enem() +
  ggplot2::theme(
    axis.ticks.x = ggplot2::element_blank(),
    axis.line.x = ggplot2::element_blank(),
    axis.text.x = ggplot2::element_blank()
  )

# gráfico do histograma das notas das redações (parte inferior da visualização)
p1_2 <- enem_cidade |>
  dplyr::select(nu_nota_redacao) |>
  ggplot2::ggplot(ggplot2::aes(x = nu_nota_redacao)) +
  ggplot2::geom_histogram(
    fill = "#11B5E4",
    color = "#000000",
    alpha = 0.7
  ) +
  ggplot2::labs(
    x = "Notas",
    y = ""
  ) +
  ggplot2::theme_classic() +
  theme_enem()


# disposição dos gráficos
p1 <- p1_1/p1_2
p1

```

<br>

Entre os alunos que realizaram o exame na cidade de **`r params$cidade`**, a maior nota **`r nota_max`** foi conquistada por `r qtd_nota_max` aluno(s). A nota média foi de **`r round(nota_media,3)`**.

<br>

### Distribuição das notas das redações por intervalo de classes.

```{r label = 'grafico_02'}
#| fig.cap = "Gráfico 02 - Diagrama de colunas da distribuição de notas por intervalos"


p2 <- tab_classes_notas |>
  ggplot2::ggplot() +
  ggplot2::aes(
    x = Var1,
    y = Freq,
    fill = Var1,
    label = round(Freq, 3)
  ) +
  ggplot2::geom_col(
    color = "#000000",
    alpha = 0.7
  ) +
  ggplot2::geom_label( # labels
    size = 5,
    color = "#000000",
    alpha = 0,
    nudge_y = 1.5
  ) +
  ggplot2::labs( # títulos dos eixos
    title = "Frequência relativa por intervalo de classes",
    x = "Intervalo de notas",
    y = "Frequência (%)"
  ) +
  ggplot2::theme(legend.position = "none") +
  ggplot2::scale_colour_viridis_d(option = "E") +
  theme_enem()

p2

```

<br> 

No gráfico 02, pode-se observar melhor como as notas de redação se distribuíram entre os valores de 0 a 1000. Os valores mostram o percentual de notas de cada intervalo. Valores maiores indicam a proporção de notas mais comuns.

<br>

### Principais razões para se atribuir nota 0 (zero) a redação

A banca avaliadora atribui nota 0 (zero) de acordo com as seguintes causas:

<ul class="a">
  <li>  Não atendimento ao tipo: a redação que possua outra estrutura textual que não seja a estrutura dissertativo-argumentativo;</li>
  <li>  Fuga ao tema: a que não atende à proposta solicitada;</li>
  <li>  Em branco: a que não apresente texto escrito na folha de redação;</li>
  <li>  Texto insuficiente: a que apresente até 7 linhas, qualquer que seja o conteúdo;</li>
  <li>  Parte desconectada: a que apresenta parte do texto deliberadamente desconectada com o tema proposto;</li>
  <li>  Anulada: a que apresenta impropérios, desenhos ou outras formas propositais de anulação, números ou sinais gráficos sem função clara em qualquer parte do texto ou  em qualquer parte da folha de redação; com assinatura, nome, iniciais, apelido, codinome ou rubrica fora do local devidamente designado para a assinatura do participante; com texto predominantemente ou integralmente escrito em língua estrangeira; ou com texto ilegível, que impossibilite sua leitura por dois avaliadores independentes e</li>
  <li>  Cópia Texto Motivador: a que contenha cópia de texto(s) da prova de redação e/ou do caderno de questões sem que haja pelo menos 8 linhas de produção própria do participante;</li>
  
</ul>

<br>

```{r label = 'grafico_03'}
#| fig.cap = "Gráfico 03 - Diagrama de barras razões para notas zero"

redacoes_com_problemas <- enem_cidade |>
  dplyr::filter(nu_nota_redacao == 0) |>
  dplyr::group_by(tp_status_redacao) |>
  dplyr::summarise(qte = dplyr::n()) |>
  dplyr::mutate(tp_status_redacao = as.factor(tp_status_redacao))


p3 <- redacoes_com_problemas |>
  ggplot2::ggplot(ggplot2::aes(
    x = qte,
    y = tp_status_redacao,
    fill = tp_status_redacao,
    label = qte
  )) +
  ggplot2::geom_col(
    color = "#000000",
    alpha = 0.7
  ) +
  ggplot2::geom_label( # labels
    size = 5,
    color = "#000000",
    alpha = 0,
    hjust = -1
  ) +
  ggplot2::labs( # títulos dos eixos
    title = "Principais razões para eliminação das redações",
    x = "Quantidade de casos",
    y = "Razões"
  ) +
  ggplot2::scale_x_continuous(limits = c(0, max(redacoes_com_problemas$qte) + 6)) +
  ggplot2::scale_color_viridis_d(option = "E") +
  ggplot2::theme(legend.position = "none") +
  theme_enem()

p3


```

```{r label = "maior_motivo_anulacao_redacao"}
#| echo = FALSE

motivo_maior_redacoes_com_problemas <- redacoes_com_problemas |> 
  dplyr::arrange(desc(qte)) |> 
  dplyr::slice_head()

```

<br> 

 O total de **`r zeros_redacao`** participante(s), entre os **`r total_alunos_municipio`** aluno(s), obtiveram nota zero , o que representa um percentual de **`r perc_zeros_redacao`%**. *`r motivo_maior_redacoes_com_problemas[1]`* foi a principal causa de notas zero nas redações dos alunos de `r params$cidade` , com **`r motivo_maior_redacoes_com_problemas[2]`** casos.

<br>

### Notas médias das competências

A nota da redação é composta por cinco competências com notas que variam de 0 a 200 pontos. A soma das seguintes competências resulta na nota final da redação do aluno.

<ul class="a">

<li>  Demonstrar domínio da modalidade escrita formal da Língua Portuguesa;</li>
<li>  Compreender a proposta de redação e aplicar conceitos das várias áreas de conhecimento para desenvolver o tema, dentro dos limites estruturais do texto dissertativo-argumentativo em prosa;</li>
<li>  Selecionar, relacionar, organizar e interpretar informações, fatos, opiniões e argumentos em defesa de um ponto de vista;</li>
<li>  Demonstrar conhecimento dos mecanismos linguísticos necessários para a construção da argumentação;</li>
<li>  Elaborar proposta de intervenção para o problema abordado, respeitando os direitos humanos.</li>

</ul>

<br>

```{r label = 'preparacao_dados_media_componentes'}
#| echo = FALSE

# ANÁLISES DAS MÉDIAS DAS NOTAS QUE COMPÕEM AS NOTAS DA REDAÇÃO

# Cálculo das médias dos componentes da redação
medias_comp_redacao <- enem_cidade |>
  dplyr::summarise(dplyr::across(
    .cols = dplyr::starts_with("nu_nota_comp"),
    .fns = mean, na.rm = TRUE
  ))

medias_comp_redacao <- medias_comp_redacao |>                           # renomear as variáveis
  dplyr::rename(
    "comp1" = "nu_nota_comp1",
    "comp2" = "nu_nota_comp2",
    "comp3" = "nu_nota_comp3",
    "comp4" = "nu_nota_comp4",
    "comp5" = "nu_nota_comp5"
  )

# VISUALIZAÇÃO DO RESULTADO

# Pivotar a base para long
medias_comp_redacao <- medias_comp_redacao |>
    tidyr::pivot_longer(
        cols = c(
            "comp1",
            "comp2",
            "comp3",
            "comp4",
            "comp5"),
        names_to = "notas_comp_redacao",
        values_to = "medias") |>
    dplyr::mutate(notas_comp_redacao = as.factor(notas_comp_redacao))

```

```{r label = 'grafico_04'}
#| fig.cap = "Gráfico 04 - Média das notas por competências das redações"


# Cosntruir o gráfico de barras das médias dos componentes que compõem a nota da redação
p4 <- medias_comp_redacao |> # base
  dplyr::mutate(
    notas_comp_redacao = forcats::fct_reorder(
      notas_comp_redacao,
      medias,
      .desc = TRUE
    )
  ) |>
  ggplot2::ggplot() + # gráfico
  ggplot2::aes(
    x = notas_comp_redacao,
    y = medias,
    fill = notas_comp_redacao,
    label = round(medias, 2)
  ) +
  ggplot2::geom_col(
    color = "#000000",
    alpha = 0.7
  ) +
  ggplot2::geom_label( # labels
    size = 5,
    color = "#000000",
    alpha = 0,
    nudge_y = 7
  ) +
  ggplot2::labs( # títulos dos eixos
    title = "Médias dos componentes da redação",
    subtitle = "A nota da redação é definida pela soma dos componentes",
    x = "Notas dos componentes",
    y = "Média das notas"
  ) + # tema
  ggplot2::theme(
    legend.position = "none"
  ) +
  theme_enem()+
  ggplot2::scale_fill_viridis_d(option = "E")

p4

```

```{r label = 'competencias_redacao_maior_menor_media'}
#| echo = FALSE

comp_max <- medias_comp_redacao |> 
    dplyr::slice_max(order_by = medias)

comp_min <- medias_comp_redacao |> 
    dplyr::slice_min(order_by = medias)

melhor_componente_redacao <- dplyr::case_when(
    medias_comp_redacao[["medias"]][1] == comp_max ~ "competência um",
    medias_comp_redacao[["medias"]][2] == comp_max ~ "competência dois",
    medias_comp_redacao[["medias"]][3] == comp_max ~ "competência três",
    medias_comp_redacao[["medias"]][4] == comp_max ~ "competência quatro",
    medias_comp_redacao[["medias"]][5] == comp_max ~ "competência cinco"
)


pior_componente_redacao <- dplyr::case_when(
    medias_comp_redacao[["medias"]][1] == comp_min ~ "competência um",
    medias_comp_redacao[["medias"]][2] == comp_min ~ "competência dois",
    medias_comp_redacao[["medias"]][3] == comp_min ~ "competência três",
    medias_comp_redacao[["medias"]][4] == comp_min ~ "competência quatro",
    medias_comp_redacao[["medias"]][5] == comp_min ~ "competência cinco"
    )

melhor_competencia <- dplyr::case_when(
    comp_max[1] == "comp1" ~ "demonstrar domínio da modalidade escrita formal da Língua Portuguesa",
    comp_max[1] == "comp2" ~ "compreender a proposta de redação e aplicar conceitos das várias áreas de conhecimento para desenvolver o tema, dentro dos limites estruturais do texto dissertativo-argumentativo em prosa",
    comp_max[1] == "comp3" ~ "selecionar, relacionar, organizar e interpretar informações, fatos, opiniões e argumentos em defesa de um ponto de vista",
    comp_max[1] == "comp4" ~ "demonstrar conhecimento dos mecanismos linguísticos necessários para a construção da argumentação",
    comp_max[1] == "comp5" ~ "elaborar proposta de intervenção para o problema abordado, respeitando os direitos humanos"
)

pior_competencia <- dplyr::case_when(
    comp_min[1] == "comp1" ~ "demonstrar domínio da modalidade escrita formal da Língua Portuguesa",
    comp_min[1] == "comp2" ~ "compreender a proposta de redação e aplicar conceitos das várias áreas de conhecimento para desenvolver o tema, dentro dos limites estruturais do texto dissertativo-argumentativo em prosa",
    comp_min[1] == "comp3" ~ "selecionar, relacionar, organizar e interpretar informações, fatos, opiniões e argumentos em defesa de um ponto de vista",
    comp_min[1] == "comp4" ~ "demonstrar conhecimento dos mecanismos linguísticos necessários para a construção da argumentação",
    comp_min[1] == "comp5" ~ "elaborar proposta de intervenção para o problema abordado, respeitando os direitos humanos"
)

```

<br>

Os alunos obtiveram o melhor desempenho na `r melhor_componente_redacao[2]` da redação, `r melhor_competencia`, com a média de **`r round(comp_max[2],2)`** e o pior desempenho na `r pior_componente_redacao[2]`, `r pior_competencia`, com a média de **`r round(comp_min[2],2)`**.

<br>

### Distribuição das notas por competências

```{r label = 'base_do_grafico_05'}
#| echo = FALSE

# pivotar a base
comp_redacao <- enem_cidade |>
  dplyr::select(
    nu_nota_comp1,
    nu_nota_comp2,
    nu_nota_comp3,
    nu_nota_comp4,
    nu_nota_comp5
  ) |>
  dplyr::rename(
    "comp1" = "nu_nota_comp1",
    "comp2" = "nu_nota_comp2",
    "comp3" = "nu_nota_comp3",
    "comp4" = "nu_nota_comp4",
    "comp5" = "nu_nota_comp5"
  )

comp_redacao_long <- comp_redacao |>
  tidyr::pivot_longer(
    cols = c(
      "comp1",
      "comp2",
      "comp3",
      "comp4",
      "comp5"
    ),
    names_to = "competencias",
    values_to = "notas_comp"
  ) |>
  dplyr::mutate(competencias = as.factor(competencias))

```

```{r label = 'gráfico_05'}
#| fig.cap = "Gráfico 05 - ViolinPlot e BoxPlot das competências das notas de redação"


p5 <- comp_redacao_long |>
  ggplot2::ggplot(ggplot2::aes(competencias,
    notas_comp,
    fill = competencias
  )) +
  ggplot2::geom_violin(width = 0.6) +
  ggplot2::geom_boxplot(
    width = 0.1,
    color = "black",
    alpha = 0.2
  ) +
  ggplot2::labs(
    title = "Densidade de distribuição das notas das competências de redação",
    x = "Competências",
    y = "Notas"
  ) +
  theme_enem() +
  ggplot2::theme(legend.position = "none")

p5
```

<br>

No gráfico acima, pode-se observar a densidade de distribuição das notas por competências exigidas na redação e as médias já apresentadas no gráfico 02. Os locais de maior área em torno dos boxplots representam maiores concentrações de dados, enquanto que locais de menor área indicam baixa concentração de dados.

<br>

### Evolução das notas das redações nos últimos anos

```{r label = 'base_grafico_06'}
#| echo = FALSE

## filtrar a base para a cidade
enem_redacao_historico <- enem |>
  dplyr::filter(no_municipio_prova == params$cidade) |>
  dplyr::select(nu_nota_redacao, nu_ano) |>
  dplyr::group_by(nu_ano) |>
  dplyr::summarise(media = mean(nu_nota_redacao, na.rm = TRUE))

## alterar tipo de ano para inteiro
enem_redacao_historico[["nu_ano"]] <- as.integer(enem_redacao_historico[["nu_ano"]])

enem_redacao_historico_notas900 <- enem |>
  dplyr::filter(no_municipio_prova == params$cidade & nu_nota_redacao >= 900) |>
  dplyr::select(nu_nota_redacao, nu_ano) |>
  dplyr::group_by(nu_ano) |>
  dplyr::summarise(qtde = dplyr::n())

enem_notas_zero <- enem |>
  dplyr::filter(no_municipio_prova == params$cidade & nu_nota_redacao == 0) |>
  dplyr::select(nu_nota_redacao, nu_ano) |>
  dplyr::group_by(nu_ano) |>
  dplyr::summarise(qtde = dplyr::n())

```


```{r label = 'gráfico_06'}
#| fig.cap = "Gráfico 06 - Gráfico de linhas - evolução das notas",
#| fig.height = 10,

p6_1 <- enem_redacao_historico |>
  ggplot2::ggplot() +
  ggplot2::aes(
    x = nu_ano,
    y = media,
    label = round(media, 2)
  ) +
  ggplot2::geom_line(color = "grey") +
  ggplot2::geom_point(
    shape = 21,
    color = "black",
    fill = "#70A288",
    size = 8
  ) +
  ggplot2::geom_text(
    vjust = -2,
    size = 5
  ) +
  theme_enem() +
  ggplot2::labs(
    title = "Médias das notas",
    x = "Ano",
    y = "Média"
  ) +
  ggplot2::scale_y_continuous(limits = c(
    min(enem_redacao_historico$media) - 50,
    max(enem_redacao_historico$media) + 50
  ))


p6_2 <- enem_redacao_historico_notas900 |>
  ggplot2::ggplot() +
  ggplot2::aes(
    x = nu_ano,
    y = qtde,
    label = qtde
  ) +
  ggplot2::geom_line(color = "grey") +
  ggplot2::geom_point(
    shape = 21,
    color = "black",
    fill = "#70A288",
    size = 6
  ) +
  ggplot2::geom_text(
    hjust = -1,
    size = 5
  ) +
  theme_enem() +
  ggplot2::labs(
    title = "Notas acima de 900",
    x = "Ano",
    y = "Quantidade"
  ) +
  ggplot2::scale_x_continuous(limits = c(
    min(enem_redacao_historico_notas900$nu_ano),
    max(enem_redacao_historico_notas900$nu_ano) + 0.8
  ))

p6_3 <- enem_notas_zero |>
  ggplot2::ggplot() +
  ggplot2::aes(
    x = nu_ano,
    y = qtde,
    label = qtde
  ) +
  ggplot2::geom_line(
    color = "grey"
  ) +
  ggplot2::geom_point(
    shape = 21,
    color = "black",
    fill = "#70A288",
    size = 6
  ) +
  ggplot2::geom_text(
    hjust = -1,
    size = 5
  ) +
  theme_enem() +
  ggplot2::labs(
    title = "Notas zero",
    x = "Ano",
    y = "Quantidade"
  ) +
  ggplot2::scale_x_continuous(limits = c(
    min(enem_redacao_historico_notas900$nu_ano),
    max(enem_redacao_historico_notas900$nu_ano) + 0.8
  ))
  
library(patchwork)

p6 <-  (p6_3 + p6_2) / p6_1

p6
```

<br>

# Prova de Linguagens e Códigos

A prova de linguagens possui 45 questões, sendo 5 de língua estrangeira. 

<br>

### Distribuição das notas de Linguagens e Códigos

```{r label = 'gráfico_07'}
#| fig.align = "center",
#| fig.cap = "Gráfico 07 - BoxPlot e histograma da distribuição de notas de Linguagens e Códigos",

# Construir a visualização composta por dois gŕaficos por meio da biblioteca patchwork
# Boxplot para observarmos principalmente a média, notas mínimas e notas máximas
# Histogram para observarmos a distribuição das notas das redações

## gráfico_07_1 - boxplot das notas 
p7_1 <- enem_cidade |>
  dplyr::select(nu_nota_lc) |>
  ggplot2::ggplot(ggplot2::aes(x = nu_nota_lc)) +
  ggplot2::geom_boxplot(
    fill = "#11B5E4",
    alpha = 0.7
  ) +
  ggplot2::labs(
    title = "Distribuição das notas de Linguagens e Códigos ",
    x = "",
    y = ""
  ) +
  ggplot2::theme_classic() +
  theme_enem() +
  ggplot2::theme(
    axis.ticks.x = ggplot2::element_blank(),
    axis.line.x = ggplot2::element_blank(),
    axis.text.x = ggplot2::element_blank()
  )
# gráfico do histograma das notas de linguagens e códigos (parte inferior da visualização)
p7_2 <- enem_cidade |>
  dplyr::select(nu_nota_lc) |>
  ggplot2::ggplot(ggplot2::aes(x = nu_nota_lc)) +
  ggplot2::geom_histogram(
    fill = "#11B5E4",
    color = "#000000",
    alpha = 0.7
  ) +
  ggplot2::labs(
    x = "Notas",
    y = ""
  ) +
  ggplot2::theme_classic() +
  theme_enem()

library(patchwork) # uso do pacote patchwork para união dos gráficos

# disposição dos gráficos
p7 <- p7_1 / p7_2
p7

```


```{r label = 'notas_máximas_lc'}
#| echo = FALSE

nota_max_lc <- enem_cidade |>
  dplyr::summarize(nota_max = max(nu_nota_lc))

nota_min_lc <- enem_cidade |>
  dplyr::summarise(nota_min = min(nu_nota_lc))

nota_media_lc <- enem_cidade |>
  dplyr::summarise(nota_media_lc = mean(nu_nota_lc, na.rm = TRUE))

```

```{r label = 'base_grafico_freq_relativa_intervalo_de_classes_lc'}
#| echo = FALSE,
#| fig.align = "center"

fabs_notas_lc <- enem_cidade |>
  dplyr::select(nu_nota_lc) |>
  table()

# total de alunos com nota máxima

qtd_nota_max_lc <- fabs_notas_lc |>
  tail(n = 1)

# criar as classes de frequências das notas

intervalo_classes_notas_lc <- seq(0, 1000, 100)

tab_classes_notas_lc <- table(
  cut(enem_cidade$nu_nota_lc,
    breaks = intervalo_classes_notas_lc,
    right = FALSE
  )
) |>
  prop.table() |>
  data.frame() |>
  dplyr::mutate(Freq = Freq * 100)

maiores_classes_notas_lc <- tab_classes_notas_lc |>
  dplyr::arrange(desc(Freq)) |>
  dplyr::slice_max(order_by = Freq, n = 2) |>
  tibble::tibble()


menores_classes_notas_lc <- tab_classes_notas_lc |>
  dplyr::arrange(desc(Var1)) |>
  dplyr::filter(Freq != 0) |>
  dplyr::slice_tail() |>
  tibble::tibble()

```

A área de conhecimento "Linguagens e Códigos e suas Tecnologias" é composta pelas disciplinas de língua portuguesa, literatura, língua estrangeira (inglês ou espanhol), artes, educação física e tecnologias da informação e comunicação.

As notas variam de 0 a 1000. A maior nota obtida no município de `r params$cidade` de **`r nota_max_lc`** foi obtida por **`r qtd_nota_max_lc`** aluno(s) e a nota média foi de **`r round(nota_media_lc,2)`**.

<br>

### Distribuição das Notas de Linguagens e Códigos  por Intervalo de Classes.

```{r label = 'grafico_08'}
#| fig.cap = "Gráfico_08_diagrama_colunas_notas_LC_por_intervalos"

p8 <- tab_classes_notas_lc |>
  ggplot2::ggplot() +
  ggplot2::aes(
    x = Var1,
    y = Freq,
    fill = Var1,
    label = round(Freq, 3)
  ) +
  ggplot2::geom_col(
    color = "#000000",
    alpha = 0.7
  ) +
  ggplot2::geom_label( # labels
    size = 5,
    color = "#000000",
    alpha = 0,
    nudge_y = 1.5
  ) +
  ggplot2::labs( # títulos dos eixos
    title = "Frequência relativa por intervalo de classes",
    subtitle = "Linguagens e Códigos e suas Tecnologias",
    x = "Intervalo de notas",
    y = "Frequência (%)"
  ) +
  ggplot2::scale_fill_viridis_d(option = "E") +
  ggplot2::theme(legend.position = "none") +
  theme_enem()

p8

```

<br>

No gráfico 08, pode-se visualizar como as notas desta área de conhecimento se distribuíram por intervalos de notas. Perceba que **`r round(sum(maiores_classes_notas_lc["Freq"]),3)`%** dos participante(s), ou seja, **`r format((sum(maiores_classes_notas_lc["Freq"]) * total_alunos_municipio)/100, scientific = FALSE)`** aluno(s) obtiveram notas nos intervalos **`r maiores_classes_notas_lc[["Var1"]][2]`** e **`r maiores_classes_notas_lc[["Var1"]][1]`**. Com relação às menores notas, tem-se que  **`r round(menores_classes_notas_lc["Freq"],3)`%** ou **`r (menores_classes_notas_lc["Freq"] * total_alunos_municipio)/100`** aluno(s) obtiveram notas no intervalo de **`r menores_classes_notas_lc[["Var1"]]`**.

<br>

### Médias das Notas por Dependência Administrativa em Linguagens e Códigos

```{r label = 'base_grafico_medias_dep_adm_lc'}
#| echo = FALSE

notas_tipo_escola_lc <- enem_cidade |>
  dplyr::select(tp_dependencia_adm_esc, nu_nota_lc) |>
  tidyr::drop_na() |>
  dplyr::group_by(tp_dependencia_adm_esc) |>
  dplyr::summarise(medias = mean(nu_nota_lc, na.rm = TRUE)) |>
  dplyr::arrange(desc(medias))

```

```{r label = 'gráfico_medias_dependencia_adm_lc'}
#| fig.cap = "Gráfico 09 - Gráfico de colunas - médias por dependência administrativa em linguagens e códigos",
#| fig.align = "center"

p9 <- notas_tipo_escola_lc |>
  ggplot2::ggplot() +
  ggplot2::aes(
    x = forcats::fct_reorder(
      tp_dependencia_adm_esc,
      medias,
      .desc = TRUE
    ),
    y = medias,
    fill = tp_dependencia_adm_esc,
    label = round(medias, 2)
  ) +
  ggplot2::geom_col(
    color = "#000000",
    alpha = 0.7
  ) +
  ggplot2::geom_label(
    size = 5,
    color = "#000000",
    alpha = 0,
    vjust = -0.5
  ) +
  ggplot2::labs(
    title = "Média das escolas por dependência administrativa",
    subtitle = "Linguagens e Códigos e suas Tecnologias",
    x = "Dependência administrativa",
    y = "Média"
  ) +
  ggplot2::theme(legend.position = "none") +
  ggplot2::scale_y_continuous(
    limits = c(0, 700),
    breaks = seq(0, 700, 100)
  ) +
  theme_enem()

p9

```

<br> 

São quatro os tipos de dependência administrativa: estadual, municipal, federal ou privada.

O gráfico 9 apresenta as notas médias por tipo de dependência administrativa existente no município de `r params$cidade`.

<br>

### Escolha da Língua Estrangeira

<br>

```{r label = 'base_grafico_10_a'}
#| echo = FALSE

p_10 <- enem_cidade |>
  dplyr::select(tp_lingua) |>
  table() |>
  as.data.frame() |>
  dplyr::mutate(tp_lingua = as.factor(tp_lingua))

# calcular as percentagens
p_10$fraction <- p_10$Freq / sum(p_10$Freq)

# calcular as percentagens acumuladas (topo de cada retângulo)
p_10$ymax <-  cumsum(p_10$fraction)

# calcular os valores mínimos de cada retângulo
p_10$ymin <- c(0, head(p_10$ymax, n = -1))

# calcular a posição do label
p_10$label_position <- (p_10$ymax + p_10$ymin)/2

# calcular o label
p_10$label <- paste0(p_10$tp_lingua, "\n value: ", p_10$Freq)



```

```{r echo=FALSE}
#| fig.cap = "Gráfico 7_a - Gráfico donnut - línguas estrangeiras",
#| fig.align = "center",
#| fig.height = 8


p_10 |>
  ggplot2::ggplot(ggplot2::aes(ymax = ymax,
                      ymin = ymin,
                      xmax = 4,
                      xmin = 3,
                      fill = tp_lingua))+
  ggplot2::geom_rect()+
  ggplot2::geom_text(x = 2, ggplot2::aes(y = label_position, label = label), size = 5)+
  ggplot2::scale_fill_brewer(palette = 1)+
  ggplot2::coord_polar(theta = 'y')+
  ggplot2::xlim(c(-1,4))+
  ggplot2::theme_void()+
  ggplot2::theme(
    legend.position = "none",
    panel.background = ggplot2::element_rect(fill = "#EBF9FF"),
    plot.background = ggplot2::element_rect(fill = "#FFFFFF"))




```

<br>

O candidato deve optar por um dos dois idiomas disponíveis no momento da inscrição, inglês ou espanhol, não sendo possível a alteração da escolha posteriormente. 

No gráfico 10, tem-se as quantidades de alunos e suas respectivas escolhas para o munícipio analisado.

<br>

### Evolução das notas de Ciências da Natureza nos últimos anos 

```{r label = 'base_grafico_10'}
#| echo = FALSE

## filtrar a base para a cidade
enem_lc_historico <- enem |>
  dplyr::filter(no_municipio_prova == params$cidade) |>
  dplyr::select(nu_nota_lc, nu_ano) |>
  dplyr::group_by(nu_ano) |>
  dplyr::summarise(media = mean(nu_nota_lc, na.rm = TRUE))

```


```{r label = 'gráfico_10'}
#| fig.cap = "Gráfico 10 - Gráfico de linhas - evolução das notas de linguagens e códigos",
#| fig.height = 10,

p10 <- enem_lc_historico |>
  ggplot2::ggplot() +
  ggplot2::aes(
    x = nu_ano,
    y = media,
    label = round(media, 2)
  ) +
  ggplot2::geom_line(color = "grey") +
  ggplot2::geom_point(
    shape = 21,
    color = "black",
    fill = "#70A288",
    size = 8
  ) +
  ggplot2::geom_text(
    vjust = -2,
    size = 5
  ) +
  theme_enem() +
  ggplot2::labs(
    title = "Médias das notas",
    subtitle = "Linguagens e Códigos e suas Tecnologias",
    x = "Ano",
    y = "Média"
  ) +
  ggplot2::scale_y_continuous(limits = c(
    min(enem_lc_historico$media) - 50,
    max(enem_lc_historico$media) + 50
  ))

p10

```

<br>

# Prova de Ciências da Natureza

### Distribuição das notas de Ciências da Natureza


```{r label = 'gráfico_11_cn'}
#| fig.align = "center",
#| fig.cap = "Gráfico 11 - BoxPlot e histograma da distribuição de notas de ciências da natureza",

# Construir a visualização composta por dois gŕaficos por meio da biblioteca patchwork
# Boxplot para observarmos principalmente a média, notas mínimas e notas máximas
# Histogram para observarmos a distribuição das notas das redações

## gráfico_11_1 - boxplot das notas 
p11_1 <- enem_cidade |>
  dplyr::select(nu_nota_cn) |>
  ggplot2::ggplot(ggplot2::aes(x = nu_nota_cn)) +
  ggplot2::geom_boxplot(
    fill = "#11B5E4",
    alpha = 0.7
  ) +
  ggplot2::labs(
    title = "Distribuição das notas de Ciências da Natureza ",
    x = "",
    y = ""
  ) +
  ggplot2::theme_classic() +
  theme_enem() +
  ggplot2::theme(
    axis.ticks.x = ggplot2::element_blank(),
    axis.line.x = ggplot2::element_blank(),
    axis.text.x = ggplot2::element_blank()
  )
# gráfico do histograma das notas das redações (parte inferior da visualização)
p11_2 <- enem_cidade |>
  dplyr::select(nu_nota_cn) |>
  ggplot2::ggplot(ggplot2::aes(x = nu_nota_cn)) +
  ggplot2::geom_histogram(
    fill = "#11B5E4",
    color = "#000000",
    alpha = 0.7
  ) +
  ggplot2::labs(
    x = "Notas",
    y = ""
  ) +
  ggplot2::theme_classic() +
  theme_enem()

library(patchwork) # uso do pacote patchwork para união dos gráficos

# disposição dos gráficos
p11 <- p11_1 / p11_2
p11

```


```{r label = 'notas_máximas_cn'}
#| echo = FALSE

nota_max_cn <- enem_cidade |>
  dplyr::summarize(nota_max = max(nu_nota_cn))

nota_min_cn <- enem_cidade |>
  dplyr::summarise(nota_min = min(nu_nota_cn))

nota_media_cn <- enem_cidade |>
  dplyr::summarise(nota_media_cn = mean(nu_nota_cn, na.rm = TRUE))

```

```{r label = 'base_grafico_freq_relativa_intervalo_de_classes_cn'}
#| echo = FALSE,
#| fig.align = "center"

fabs_notas_cn <- enem_cidade |>
  dplyr::select(nu_nota_cn) |>
  table()

# total de alunos com nota máxima

qtd_nota_max_cn <- fabs_notas_cn |>
  tail(n = 1)

# criar as classes de frequências das notas

intervalo_classes_notas_cn <- seq(0, 1000, 100)

tab_classes_notas_cn <- table(
  cut(enem_cidade$nu_nota_cn,
    breaks = intervalo_classes_notas_cn,
    right = FALSE
  )
) |>
  prop.table() |>
  data.frame() |>
  dplyr::mutate(Freq = Freq * 100)

maiores_classes_notas_cn <- tab_classes_notas_cn |>
  dplyr::arrange(desc(Freq)) |>
  dplyr::slice_max(order_by = Freq, n = 2) |>
  tibble::tibble()


menores_classes_notas_cn <- tab_classes_notas_cn |>
  dplyr::arrange(desc(Var1)) |>
  dplyr::filter(Freq != 0) |>
  dplyr::slice_tail() |>
  tibble::tibble()

```

A área de conhecimento "Ciências da Natureza e suas Tecnologias" é composta pelas disciplinas de química, física e biologia. 

As notas variam de 0 a 1000. A maior nota obtida no município de `r params$cidade` de **`r nota_max_cn`** foi obtida por **`r qtd_nota_max_cn`** aluno(s) e a nota média foi de **`r round(nota_media_cn,2)`**.

<br>

### Distribuição das notas de Ciências da Natureza por intervalo de classes.

```{r label = 'grafico_012'}
#| fig.cap = "Gráfico_09_diagrama_colunas_notas_CN_por_intervalos"

p12 <- tab_classes_notas_cn |>
  ggplot2::ggplot() +
  ggplot2::aes(
    x = Var1,
    y = Freq,
    fill = Var1,
    label = round(Freq, 3)
  ) +
  ggplot2::geom_col(
    color = "#000000",
    alpha = 0.7
  ) +
  ggplot2::geom_label( # labels
    size = 5,
    color = "#000000",
    alpha = 0,
    nudge_y = 1.5
  ) +
  ggplot2::labs( # títulos dos eixos
    title = "Frequência relativa por intervalo de classes",
    subtitle = "Ciências da Natureza e suas Tecnologias",
    x = "Intervalo de notas",
    y = "Frequência (%)"
  ) +
  ggplot2::scale_fill_viridis_d(option = "E") +
  ggplot2::theme(legend.position = "none") +
  theme_enem()

p12

```

<br>

No gráfico 09, pode-se visualizar como as notas desta área de conhecimento se distribuíram por intervalos de notas. Perceba que **`r round(sum(maiores_classes_notas_cn["Freq"]),3)`%** dos participante(s), ou seja, **`r format((sum(maiores_classes_notas_cn["Freq"]) * total_alunos_municipio)/100, scientific = FALSE)`** aluno(s) obtiveram notas nos intervalos **`r maiores_classes_notas_cn[["Var1"]][2]`** e **`r maiores_classes_notas_cn[["Var1"]][1]`**. Com relação às menores notas, tem-se que  **`r round(menores_classes_notas_cn["Freq"],3)`%** ou **`r (menores_classes_notas_cn["Freq"] * total_alunos_municipio)/100`** aluno(s) obtiveram notas no intervalo de **`r menores_classes_notas_cn[["Var1"]]`**.

<br>

### Médias das notas por dependência administrativa

```{r label = 'base_grafico_medias_dep_adm_cn'}
#| echo = FALSE

notas_tipo_escola <- enem_cidade |>
  dplyr::select(tp_dependencia_adm_esc, nu_nota_cn) |>
  tidyr::drop_na() |>
  dplyr::group_by(tp_dependencia_adm_esc) |>
  dplyr::summarise(medias = mean(nu_nota_cn, na.rm = TRUE)) |>
  dplyr::arrange(desc(medias))

```

```{r label = 'gráfico_medias_dependencia_adm'}
#| fig.cap = "Gráfico 10 - Gráfico de colunas - médias por dependência administrativa na prova de Ciências da Natureza",
#| fig.align = "center"

p13 <- notas_tipo_escola |>
  ggplot2::ggplot() +
  ggplot2::aes(
    x = forcats::fct_reorder(
      tp_dependencia_adm_esc,
      medias,
      .desc = TRUE
    ),
    y = medias,
    fill = tp_dependencia_adm_esc,
    label = round(medias, 2)
  ) +
  ggplot2::geom_col(
    color = "#000000",
    alpha = 0.7
  ) +
  ggplot2::geom_label(
    size = 5,
    color = "#000000",
    alpha = 0,
    vjust = -0.5
  ) +
  ggplot2::labs(
    title = "Média das escolas por dependência administrativa",
    subtitle = "Ciências da Natureza e suas Tecnologias",
    x = "Dependência administrativa",
    y = "Média"
  ) +
  ggplot2::theme(legend.position = "none") +
  ggplot2::scale_y_continuous(
    limits = c(0, 700),
    breaks = seq(0, 700, 100)
  ) +
  theme_enem()

p13

```

<br> 

São quatro os tipos de dependência administrativa: estadual, municipal, federal ou privada.

O gráfico 10 apresenta as notas médias por tipo de dependência administrativa existente no município de `r params$cidade`.

### Evolução das notas de Ciências da Natureza nos últimos anos 

```{r label = 'base_grafico_11'}
#| echo = FALSE

## filtrar a base para a cidade
enem_cn_historico <- enem |>
  dplyr::filter(no_municipio_prova == params$cidade) |>
  dplyr::select(nu_nota_cn, nu_ano) |>
  dplyr::group_by(nu_ano) |>
  dplyr::summarise(media = mean(nu_nota_cn, na.rm = TRUE))

```


```{r label = 'gráfico_11'}
#| fig.cap = "Gráfico 11 - Gráfico de linhas - evolução das notas de Ciências da Natureza",
#| fig.height = 10,

p11 <- enem_cn_historico |>
  ggplot2::ggplot() +
  ggplot2::aes(
    x = nu_ano,
    y = media,
    label = round(media, 2)
  ) +
  ggplot2::geom_line(color = "grey") +
  ggplot2::geom_point(
    shape = 21,
    color = "black",
    fill = "#70A288",
    size = 8
  ) +
  ggplot2::geom_text(
    vjust = -2,
    size = 5
  ) +
  theme_enem() +
  ggplot2::labs(
    title = "Médias das notas",
    subtitle = "Ciências da Natureza e suas Tecnologias",
    x = "Ano",
    y = "Média"
  ) +
  ggplot2::scale_y_continuous(limits = c(
    min(enem_cn_historico$media) - 50,
    max(enem_cn_historico$media) + 50
  ))

p11

```

<br>

# Prova de Ciências Humanas

### Distribuição das notas de Ciências da Natureza

```{r label = 'gráfico_12'}
#| fig.align = "center",
#| fig.cap = "Gráfico 12 - BoxPlot e histograma da distribuição de notas de ciências humanas",

## gráfico_12_1 - boxplot das notas 
p12_1 <- enem_cidade |>
  dplyr::select(nu_nota_ch) |>
  ggplot2::ggplot(ggplot2::aes(x = nu_nota_ch)) +
  ggplot2::geom_boxplot(
    fill = "#11B5E4",
    alpha = 0.7
  ) +
  ggplot2::labs(
    title = "Distribuição das notas de Ciências Humanas ",
    x = "",
    y = ""
  ) +
  ggplot2::theme_classic() +
  theme_enem() +
  ggplot2::theme(
    axis.ticks.x = ggplot2::element_blank(),
    axis.line.x = ggplot2::element_blank(),
    axis.text.x = ggplot2::element_blank()
  )
# gráfico do histograma das notas das redações (parte inferior da visualização)
p12_2 <- enem_cidade |>
  dplyr::select(nu_nota_ch) |>
  ggplot2::ggplot(ggplot2::aes(x = nu_nota_ch)) +
  ggplot2::geom_histogram(
    fill = "#11B5E4",
    color = "#000000",
    alpha = 0.7
  ) +
  ggplot2::labs(
    x = "Notas",
    y = ""
  ) +
  ggplot2::theme_classic() +
  theme_enem()

library(patchwork) # uso do pacote patchwork para união dos gráficos

# disposição dos gráficos
p12 <- p12_1 / p12_2
p12

```


```{r label = 'notas_máximas_ch'}
#| echo = FALSE

nota_max_ch <- enem_cidade |>
  dplyr::summarize(nota_max = max(nu_nota_ch))

nota_min_ch <- enem_cidade |>
  dplyr::summarise(nota_min = min(nu_nota_ch))

nota_media_ch <- enem_cidade |>
  dplyr::summarise(nota_media_ch = mean(nu_nota_ch, na.rm = TRUE))

```

```{r label = 'base_grafico_freq_relativa_intervalo_de_classes_ch'}
#| echo = FALSE,
#| fig.align = "center"

fabs_notas_ch <- enem_cidade |>
  dplyr::select(nu_nota_ch) |>
  table()

# total de alunos com nota máxima

qtd_nota_max_ch <- fabs_notas_ch |>
  tail(n = 1)

# criar as classes de frequências das notas

intervalo_classes_notas_ch <- seq(0, 1000, 100)

tab_classes_notas_ch <- table(
  cut(enem_cidade$nu_nota_ch,
    breaks = intervalo_classes_notas_ch,
    right = FALSE
  )
) |>
  prop.table() |>
  data.frame() |>
  dplyr::mutate(Freq = Freq * 100)

maiores_classes_notas_ch <- tab_classes_notas_ch |>
  dplyr::arrange(desc(Freq)) |>
  dplyr::slice_max(order_by = Freq, n = 2) |>
  tibble::tibble()


menores_classes_notas_ch <- tab_classes_notas_ch |>
  dplyr::arrange(desc(Var1)) |>
  dplyr::filter(Freq != 0) |>
  dplyr::slice_tail() |>
  tibble::tibble()

```
<br>
A área de conhecimento "Ciências Humanas e suas Tecnologias" é composta pelas disciplinas de história, geografia, filosofia e sociologia 

A maior nota obtida no município de `r params$cidade` de **`r nota_max_ch`** foi obtida por **`r qtd_nota_max_ch`** aluno(s) e a nota média foi de **`r round(nota_media_ch,2)`**.

<br>

### Distribuição das notas de Ciências Humanas por intervalo de classes.

```{r label = 'grafico_13'}
#| fig.cap = "Gráfico 13 - Diagrama de colunas das notas de Ciências Humanas por intervalos"

p13 <- tab_classes_notas_ch |>
  ggplot2::ggplot() +
  ggplot2::aes(
    x = Var1,
    y = Freq,
    fill = Var1,
    label = round(Freq, 3)
  ) +
  ggplot2::geom_col(
    color = "#000000",
    alpha = 0.7
  ) +
  ggplot2::geom_label( # labels
    size = 5,
    color = "#000000",
    alpha = 0,
    nudge_y = 1.5
  ) +
  ggplot2::labs( # títulos dos eixos
    title = "Frequência relativa por intervalo de classes",
    subtitle = "Ciências Humanas e suas Tecnologias",
    x = "Intervalo de notas",
    y = "Frequência (%)"
  ) +
  ggplot2::scale_fill_viridis_d(option = "E") +
  ggplot2::theme(legend.position = "none") +
  theme_enem()

p13

```

<br>

No gráfico 13, pode-se visualizar como as notas desta área de conhecimento se distribuíram por intervalos de notas. Perceba que **`r round(sum(maiores_classes_notas_ch["Freq"]),3)`%** dos participante(s), ou seja, **`r format((sum(maiores_classes_notas_ch["Freq"]) * total_alunos_municipio)/100, scientific = FALSE)`** aluno(s) obtiveram notas nos intervalos **`r maiores_classes_notas_ch[["Var1"]][2]`** e **`r maiores_classes_notas_ch[["Var1"]][1]`**. Com relação às menores notas, tem-se que  **`r round(menores_classes_notas_ch["Freq"],3)`%** ou **`r (menores_classes_notas_ch["Freq"] * total_alunos_municipio)/100`** aluno(s) obtiveram notas no intervalo de **`r menores_classes_notas_ch[["Var1"]]`**.

<br>

### Médias das notas por dependência administrativa

```{r label = 'base_grafico_medias_dep_adm_ciencias_humanas'}
#| fig.cap = "Média por tipo de dependência administrativa",
#| echo = FALSE

notas_tipo_escola_ch <- enem_cidade |>
  dplyr::select(tp_dependencia_adm_esc, nu_nota_ch) |>
  tidyr::drop_na() |>
  dplyr::group_by(tp_dependencia_adm_esc) |>
  dplyr::summarise(medias = mean(nu_nota_ch, na.rm = TRUE)) |>
  dplyr::arrange(desc(medias))

```

```{r label = 'gráfico_14_medias_dependencia_adm_ciencias_humanas'}
#| fig.align = "center"

p14 <- notas_tipo_escola_ch |>
  ggplot2::ggplot() +
  ggplot2::aes(
    x = forcats::fct_reorder(
      tp_dependencia_adm_esc,
      medias,
      .desc = TRUE
    ),
    y = medias,
    fill = tp_dependencia_adm_esc,
    label = round(medias, 2)
  ) +
  ggplot2::geom_col(
    color = "#000000",
    alpha = 0.7
  ) +
  ggplot2::geom_label(
    size = 5,
    color = "#000000",
    alpha = 0,
    vjust = -0.5
  ) +
  ggplot2::labs(
    title = "Média das escolas por dependência administrativa",
    subtitle = "Ciências Humanas e suas Tecnologias",
    x = "Dependência administrativa",
    y = "Média"
  ) +
  ggplot2::theme(legend.position = "none") +
  ggplot2::scale_y_continuous(
    limits = c(0, 700),
    breaks = seq(0, 700, 100)
  ) +
  theme_enem()

p14

```

<br> 

### Evolução das notas de Ciências Humanas nos últimos anos 

```{r label = 'base_grafico_15'}
#| echo = FALSE

## filtrar a base para a cidade
enem_ch_historico <- enem |>
  dplyr::filter(no_municipio_prova == params$cidade) |>
  dplyr::select(nu_nota_ch, nu_ano) |>
  dplyr::group_by(nu_ano) |>
  dplyr::summarise(media = mean(nu_nota_ch, na.rm = TRUE))

```


```{r label = 'gráfico_15'}
#| fig.cap = "Gráfico 15 - Gráfico de linhas - evolução das notas de CH",
#| fig.height = 10,

p15 <- enem_ch_historico |>
  ggplot2::ggplot() +
  ggplot2::aes(
    x = nu_ano,
    y = media,
    label = round(media, 2)
  ) +
  ggplot2::geom_line(color = "grey") +
  ggplot2::geom_point(
    shape = 21,
    color = "black",
    fill = "#70A288",
    size = 8
  ) +
  ggplot2::geom_text(
    vjust = -2,
    size = 5
  ) +
  theme_enem() +
  ggplot2::labs(
    title = "Médias das notas",
    subtitle = "Ciências Humanas e suas Tecnologias",
    x = "Ano",
    y = "Média"
  ) +
  ggplot2::scale_y_continuous(limits = c(
    min(enem_ch_historico$media) - 50,
    max(enem_ch_historico$media) + 50
  ))

p15

```
